Fill data
kmysql <data.sql

Product Materialized view
kvtctl Materialize -workflow=UserProduct -purpose=unified_view -create_table -is_reference product.product customer.product

Merchant Orders
kvtctl Materialize -workflow=MerchantOrder -purpose=unified_view -create_table -primary_vindex=mname:md5 customer.orders merchant.orders

Sales schema
kvtctl ApplySchema -sql='create table sales(pid int, kount int, amount int, primary key(pid))' product

Materialize sales
kvtctl Materialize -workflow ProductSales -expression 'select pid, count(*) as kount, sum(price) as amount from orders group by pid' customer.orders product.sales

Migrate orders
kvtctl MigrateReads merchant MerchantOrder rdonly
kvtctl MigrateReads merchant MerchantOrder replica
kvtctl MigrateWrites merchant MerchantOrder
