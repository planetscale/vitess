[
    {
        "SQL": "delete from music_extra where id=1",
        "Plans": [
            {
                "Original": "delete from music_extra where id = :vtg1",
                "Instructions": {
                    "Opcode": "DeleteEqual",
                    "Keyspace": {
                        "Name": "ks_sharded",
                        "Sharded": true
                    },
                    "Query": "delete from music_extra where id = :vtg1",
                    "Vindex": "hash",
                    "Values": [
                        ":vtg1"
                    ],
                    "Table": "music_extra"
                },
                "ExecCount": 1,
                "ExecTime": 0,
                "ShardQueries": 1,
                "Rows": 1,
                "Errors": 0
            }
        ],
        "TabletActions": {
            "ks_sharded/-40": {
                "TabletQueries": [
                    {
                        "Time": 1,
                        "SQL": "delete from music_extra where id = :vtg1 /* vtgate:: keyspace_id:166b40b44aba4bd6 */",
                        "BindVars": {
                            "#maxLimit": "10001",
                            "vtg1": "1"
                        }
                    }
                ],
                "MysqlQueries": [
                    {
                        "Time": 1,
                        "SQL": "begin"
                    },
                    {
                        "Time": 1,
                        "SQL": "delete from music_extra where id in (1) /* vtgate:: keyspace_id:166b40b44aba4bd6 */"
                    },
                    {
                        "Time": 2,
                        "SQL": "commit"
                    }
                ]
            }
        }
    },
    {
        "SQL": "delete from music_extra where id=1 and extra='abc'",
        "Plans": [
            {
                "Original": "delete from music_extra where id = :vtg1 and extra = :vtg2",
                "Instructions": {
                    "Opcode": "DeleteEqual",
                    "Keyspace": {
                        "Name": "ks_sharded",
                        "Sharded": true
                    },
                    "Query": "delete from music_extra where id = :vtg1 and extra = :vtg2",
                    "Vindex": "hash",
                    "Values": [
                        ":vtg1"
                    ],
                    "Table": "music_extra"
                },
                "ExecCount": 1,
                "ExecTime": 0,
                "ShardQueries": 1,
                "Rows": 1,
                "Errors": 0
            }
        ],
        "TabletActions": {
            "ks_sharded/-40": {
                "TabletQueries": [
                    {
                        "Time": 1,
                        "SQL": "delete from music_extra where id = :vtg1 and extra = :vtg2 /* vtgate:: keyspace_id:166b40b44aba4bd6 */",
                        "BindVars": {
                            "#maxLimit": "10001",
                            "vtg1": "1",
                            "vtg2": "'abc'"
                        }
                    }
                ],
                "MysqlQueries": [
                    {
                        "Time": 1,
                        "SQL": "begin"
                    },
                    {
                        "Time": 1,
                        "SQL": "select id from music_extra where id = 1 and extra = 'abc' limit 10001 for update /* vtgate:: keyspace_id:166b40b44aba4bd6 */"
                    },
                    {
                        "Time": 1,
                        "SQL": "delete from music_extra where id in (1) /* vtgate:: keyspace_id:166b40b44aba4bd6 */"
                    },
                    {
                        "Time": 2,
                        "SQL": "commit"
                    }
                ]
            }
        }
    },
    {
        "SQL": "delete from user where id=1",
        "Plans": [
            {
                "Original": "delete from name_user_map where name = :name and user_id = :user_id",
                "Instructions": {
                    "Opcode": "DeleteEqual",
                    "Keyspace": {
                        "Name": "ks_sharded",
                        "Sharded": true
                    },
                    "Query": "delete from name_user_map where name = :name and user_id = :user_id",
                    "Vindex": "md5",
                    "Values": [
                        ":name"
                    ],
                    "Table": "name_user_map"
                },
                "ExecCount": 1,
                "ExecTime": 0,
                "ShardQueries": 1,
                "Rows": 1,
                "Errors": 0
            },
            {
                "Original": "delete from user where id = :vtg1",
                "Instructions": {
                    "Opcode": "DeleteEqual",
                    "Keyspace": {
                        "Name": "ks_sharded",
                        "Sharded": true
                    },
                    "Query": "delete from user where id = :vtg1",
                    "Vindex": "hash",
                    "Values": [
                        ":vtg1"
                    ],
                    "Table": "user",
                    "Subquery": "select name from user where id = :vtg1 for update"
                },
                "ExecCount": 1,
                "ExecTime": 0,
                "ShardQueries": 2,
                "Rows": 1,
                "Errors": 0
            }
        ],
        "TabletActions": {
            "ks_sharded/-40": {
                "TabletQueries": [
                    {
                        "Time": 1,
                        "SQL": "select name from user where id = :vtg1 for update",
                        "BindVars": {
                            "#maxLimit": "10001",
                            "vtg1": "1"
                        }
                    },
                    {
                        "Time": 3,
                        "SQL": "delete from user where id = :vtg1 /* vtgate:: keyspace_id:166b40b44aba4bd6 */",
                        "BindVars": {
                            "#maxLimit": "10001",
                            "vtg1": "1"
                        }
                    }
                ],
                "MysqlQueries": [
                    {
                        "Time": 1,
                        "SQL": "begin"
                    },
                    {
                        "Time": 1,
                        "SQL": "select name from user where id = 1 limit 10001 for update"
                    },
                    {
                        "Time": 3,
                        "SQL": "delete from user where id in (1) /* vtgate:: keyspace_id:166b40b44aba4bd6 */"
                    },
                    {
                        "Time": 4,
                        "SQL": "begin"
                    },
                    {
                        "Time": 4,
                        "SQL": "insert into `_vt`.dt_state(dtid, state, time_created) values ('ks_sharded:-40:1515392388787015722', 1, 1515392388898391433)"
                    },
                    {
                        "Time": 4,
                        "SQL": "insert into `_vt`.dt_participant(dtid, id, keyspace, shard) values ('ks_sharded:-40:1515392388787015722', 1, 'ks_sharded', '80-c0')"
                    },
                    {
                        "Time": 4,
                        "SQL": "commit"
                    },
                    {
                        "Time": 6,
                        "SQL": "update `_vt`.dt_state set state = 2 where dtid = 'ks_sharded:-40:1515392388787015722' and state = 1"
                    },
                    {
                        "Time": 6,
                        "SQL": "commit"
                    },
                    {
                        "Time": 8,
                        "SQL": "begin"
                    },
                    {
                        "Time": 8,
                        "SQL": "delete from `_vt`.dt_state where dtid = 'ks_sharded:-40:1515392388787015722'"
                    },
                    {
                        "Time": 8,
                        "SQL": "delete from `_vt`.dt_participant where dtid = 'ks_sharded:-40:1515392388787015722'"
                    },
                    {
                        "Time": 8,
                        "SQL": "commit"
                    }
                ]
            },
            "ks_sharded/80-c0": {
                "TabletQueries": [
                    {
                        "Time": 2,
                        "SQL": "delete from name_user_map where name = :name and user_id = :user_id /* vtgate:: keyspace_id:a6e89b54b129c33051b76db219595660 */",
                        "BindVars": {
                            "#maxLimit": "10001",
                            "name": "'name_val_1'",
                            "user_id": "1"
                        }
                    }
                ],
                "MysqlQueries": [
                    {
                        "Time": 2,
                        "SQL": "begin"
                    },
                    {
                        "Time": 2,
                        "SQL": "delete from name_user_map where (name = 'name_val_1' and user_id = 1) /* vtgate:: keyspace_id:a6e89b54b129c33051b76db219595660 */"
                    },
                    {
                        "Time": 5,
                        "SQL": "begin"
                    },
                    {
                        "Time": 5,
                        "SQL": "insert into `_vt`.redo_state(dtid, state, time_created) values ('ks_sharded:-40:1515392388787015722', 1, 1515392388909259045)"
                    },
                    {
                        "Time": 5,
                        "SQL": "insert into `_vt`.redo_statement(dtid, id, statement) values ('ks_sharded:-40:1515392388787015722', 1, 'delete from name_user_map where (name = \\'name_val_1\\' and user_id = 1) /* vtgate:: keyspace_id:a6e89b54b129c33051b76db219595660 */')"
                    },
                    {
                        "Time": 5,
                        "SQL": "commit"
                    },
                    {
                        "Time": 7,
                        "SQL": "delete from `_vt`.redo_state where dtid = 'ks_sharded:-40:1515392388787015722'"
                    },
                    {
                        "Time": 7,
                        "SQL": "delete from `_vt`.redo_statement where dtid = 'ks_sharded:-40:1515392388787015722'"
                    },
                    {
                        "Time": 7,
                        "SQL": "commit"
                    }
                ]
            }
        }
    },
    {
        "SQL": "delete from user where name='billy'",
        "Plans": [
            {
                "Original": "delete from name_user_map where name = :name and user_id = :user_id",
                "Instructions": {
                    "Opcode": "DeleteEqual",
                    "Keyspace": {
                        "Name": "ks_sharded",
                        "Sharded": true
                    },
                    "Query": "delete from name_user_map where name = :name and user_id = :user_id",
                    "Vindex": "md5",
                    "Values": [
                        ":name"
                    ],
                    "Table": "name_user_map"
                },
                "ExecCount": 1,
                "ExecTime": 0,
                "ShardQueries": 1,
                "Rows": 1,
                "Errors": 0
            },
            {
                "Original": "select user_id from name_user_map where name = :name",
                "Instructions": {
                    "Opcode": "SelectEqualUnique",
                    "Keyspace": {
                        "Name": "ks_sharded",
                        "Sharded": true
                    },
                    "Query": "select user_id from name_user_map where name = :name",
                    "FieldQuery": "select user_id from name_user_map where 1 != 1",
                    "Vindex": "md5",
                    "Values": [
                        ":name"
                    ]
                },
                "ExecCount": 1,
                "ExecTime": 0,
                "ShardQueries": 1,
                "Rows": 1,
                "Errors": 0
            },
            {
                "Original": "delete from user where name = :vtg1",
                "Instructions": {
                    "Opcode": "DeleteEqual",
                    "Keyspace": {
                        "Name": "ks_sharded",
                        "Sharded": true
                    },
                    "Query": "delete from user where name = :vtg1",
                    "Vindex": "name_user_map",
                    "Values": [
                        ":vtg1"
                    ],
                    "Table": "user",
                    "Subquery": "select name from user where name = :vtg1 for update"
                },
                "ExecCount": 1,
                "ExecTime": 0,
                "ShardQueries": 2,
                "Rows": 1,
                "Errors": 0
            }
        ],
        "TabletActions": {
            "ks_sharded/-40": {
                "TabletQueries": [
                    {
                        "Time": 2,
                        "SQL": "select name from user where name = :vtg1 for update",
                        "BindVars": {
                            "#maxLimit": "10001",
                            "vtg1": "'billy'"
                        }
                    },
                    {
                        "Time": 4,
                        "SQL": "delete from user where name = :vtg1 /* vtgate:: keyspace_id:166b40b44aba4bd6 */",
                        "BindVars": {
                            "#maxLimit": "10001",
                            "vtg1": "'billy'"
                        }
                    }
                ],
                "MysqlQueries": [
                    {
                        "Time": 2,
                        "SQL": "begin"
                    },
                    {
                        "Time": 2,
                        "SQL": "select name from user where name = 'billy' limit 10001 for update"
                    },
                    {
                        "Time": 4,
                        "SQL": "select id from user where name = 'billy' limit 10001 for update /* vtgate:: keyspace_id:166b40b44aba4bd6 */"
                    },
                    {
                        "Time": 4,
                        "SQL": "delete from user where id in (1) /* vtgate:: keyspace_id:166b40b44aba4bd6 */"
                    },
                    {
                        "Time": 6,
                        "SQL": "begin"
                    },
                    {
                        "Time": 6,
                        "SQL": "insert into `_vt`.redo_state(dtid, state, time_created) values ('ks_sharded:c0-:1515392388798209886', 1, 1515392389021902468)"
                    },
                    {
                        "Time": 6,
                        "SQL": "insert into `_vt`.redo_statement(dtid, id, statement) values ('ks_sharded:c0-:1515392388798209886', 1, 'delete from user where id in (1) /* vtgate:: keyspace_id:166b40b44aba4bd6 */')"
                    },
                    {
                        "Time": 6,
                        "SQL": "commit"
                    },
                    {
                        "Time": 8,
                        "SQL": "delete from `_vt`.redo_state where dtid = 'ks_sharded:c0-:1515392388798209886'"
                    },
                    {
                        "Time": 8,
                        "SQL": "delete from `_vt`.redo_statement where dtid = 'ks_sharded:c0-:1515392388798209886'"
                    },
                    {
                        "Time": 8,
                        "SQL": "commit"
                    }
                ]
            },
            "ks_sharded/80-c0": {
                "TabletQueries": [
                    {
                        "Time": 3,
                        "SQL": "delete from name_user_map where name = :name and user_id = :user_id /* vtgate:: keyspace_id:a6e89b54b129c33051b76db219595660 */",
                        "BindVars": {
                            "#maxLimit": "10001",
                            "name": "'name_val_1'",
                            "user_id": "1"
                        }
                    }
                ],
                "MysqlQueries": [
                    {
                        "Time": 3,
                        "SQL": "begin"
                    },
                    {
                        "Time": 3,
                        "SQL": "delete from name_user_map where (name = 'name_val_1' and user_id = 1) /* vtgate:: keyspace_id:a6e89b54b129c33051b76db219595660 */"
                    },
                    {
                        "Time": 6,
                        "SQL": "begin"
                    },
                    {
                        "Time": 6,
                        "SQL": "insert into `_vt`.redo_state(dtid, state, time_created) values ('ks_sharded:c0-:1515392388798209886', 1, 1515392389021902697)"
                    },
                    {
                        "Time": 6,
                        "SQL": "insert into `_vt`.redo_statement(dtid, id, statement) values ('ks_sharded:c0-:1515392388798209886', 1, 'delete from name_user_map where (name = \\'name_val_1\\' and user_id = 1) /* vtgate:: keyspace_id:a6e89b54b129c33051b76db219595660 */')"
                    },
                    {
                        "Time": 6,
                        "SQL": "commit"
                    },
                    {
                        "Time": 8,
                        "SQL": "delete from `_vt`.redo_state where dtid = 'ks_sharded:c0-:1515392388798209886'"
                    },
                    {
                        "Time": 8,
                        "SQL": "delete from `_vt`.redo_statement where dtid = 'ks_sharded:c0-:1515392388798209886'"
                    },
                    {
                        "Time": 8,
                        "SQL": "commit"
                    }
                ]
            },
            "ks_sharded/c0-": {
                "TabletQueries": [
                    {
                        "Time": 1,
                        "SQL": "select user_id from name_user_map where name = :name",
                        "BindVars": {
                            "#maxLimit": "10001",
                            "name": "'billy'"
                        }
                    }
                ],
                "MysqlQueries": [
                    {
                        "Time": 1,
                        "SQL": "begin"
                    },
                    {
                        "Time": 1,
                        "SQL": "select user_id from name_user_map where name = 'billy' limit 10001"
                    },
                    {
                        "Time": 5,
                        "SQL": "begin"
                    },
                    {
                        "Time": 5,
                        "SQL": "insert into `_vt`.dt_state(dtid, state, time_created) values ('ks_sharded:c0-:1515392388798209886', 1, 1515392389009197532)"
                    },
                    {
                        "Time": 5,
                        "SQL": "insert into `_vt`.dt_participant(dtid, id, keyspace, shard) values ('ks_sharded:c0-:1515392388798209886', 1, 'ks_sharded', '-40'), ('ks_sharded:c0-:1515392388798209886', 2, 'ks_sharded', '80-c0')"
                    },
                    {
                        "Time": 5,
                        "SQL": "commit"
                    },
                    {
                        "Time": 7,
                        "SQL": "update `_vt`.dt_state set state = 2 where dtid = 'ks_sharded:c0-:1515392388798209886' and state = 1"
                    },
                    {
                        "Time": 7,
                        "SQL": "commit"
                    },
                    {
                        "Time": 9,
                        "SQL": "begin"
                    },
                    {
                        "Time": 9,
                        "SQL": "delete from `_vt`.dt_state where dtid = 'ks_sharded:c0-:1515392388798209886'"
                    },
                    {
                        "Time": 9,
                        "SQL": "delete from `_vt`.dt_participant where dtid = 'ks_sharded:c0-:1515392388798209886'"
                    },
                    {
                        "Time": 9,
                        "SQL": "commit"
                    }
                ]
            }
        }
    }
]
